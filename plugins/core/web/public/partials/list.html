<div ng-controller="listController" id="listController">
  <script type="text/javascript">
    var socket = io.connect();
    socket.on("trigger", function(bell) {
      angular.element("#listController").scope().loadData()
      angular.element("#listController").scope().toast("success", bell.Name + " has been triggered", "OK!")
    })

    socket.on("bells_bellchanged", function() {
      angular.element("#listController").scope().loadData()
    })
  </script>
  <h1>Bells</h1>
  <p><span ng-bind="(bells | filter: { Enabled: true }).length"></span> / <span ng-bind="(bells).length"></span> bells loaded</p>
  <div class="form-horizontal">
    <div class="form-group">
      <label for="query" class="col-sm-1 control-label">Search:</label>
      <div class="col-sm-3">
        <input ng-model="query" class="form-control input-sm">
      </div>
      <label for="orderBy" class="col-sm-1 control-label">Order by:</label>
      <div class="col-sm-3">
        <select ng-model="orderBy" class="form-control input-sm">
          <option value="">-----</option>
          <option value="!TimeDifference">Time (Descending)</option>
          <option value="TimeDifference">Time (Ascending)</option>
          <option value="Name">Alphabetical</option>
          <option value="!Enabled">Enabled</option>
        </select>
      </div>
      <div class="col-sm-3">
        <a ng-click="reload()" href="#">Reload</a>
      </div>
    </div>
  </div>
  <table border="1" cellpadding="10" cellspacing="0" class="table table-bordered table-hover">
    <tr cellpadding="5" class="colour">
      <th>
        Name
      </th>
      <th>
        Description
      </th>
      <th>
        Next Time
      </th>
      <th>Actions</th>
    </tr>
    <tr ng-repeat="bell in bells | filter:query | orderBy:orderBy" ng-class="{ 'next': nextBell[0].id == bell.ID }">
      <td ng-class="{'disabled': !bell.Enabled}" ng-bind="bell.Name"></td>
      <td ng-bind="bell.Description"></td>
      <td ng-include src="'/api/bells/next/' + bell.ID + '/date?a=' + curTime"></td>
      <td>
        <a href="#/bells/view/{{ bell.ID }}">View</a> |
        <a href="#/bells/edit/{{ bell.ID }}">Edit</a>
        <span ng-if="!bell.Locked"> |
          <a href="" ng-click="toggleBell(bell.ID, true)" ng-if="!bell.Enabled">Enable</a>
          <a href="" ng-click="toggleBell(bell.ID, false)" ng-if="bell.Enabled">Disable</a>
        </span>
      </td>
    </tr>
  </table>
</div>
